<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exfoliator Control Interface</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">

    <script src="..static/script.js"></script>
    <link rel="stylesheet" href="..static/styles.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1 class="title">
                <span>üî¨</span>
                Exfoliator Control Interface
            </h1>
            <div id="connectionStatus" class="status disconnected">
                <div class="status-dot"></div>
                <span>Disconnected</span>
            </div>



        </div>

        <!-- Emergency Stop -->

        <div class="emergency-container">
            <button class="button btn-emergency" onclick="emergencyStop()">üõë EMERGENCY STOP</button>
        </div>


        <div class="grid">
            <!-- Position Controls -->
            <div class="card">
                <h2 class="card-title">
                    <span>üìç</span>
                    Position Control
                </h2>
                
                <!-- Current Position -->
                <div class="mb-4">
                    <h3 class="section-title">Current Position</h3>
                    <div class="position-display">
                        <span>X Position:</span>
                        <div style="display: flex; align-items: center;">
                            <span id="posX">0.0 mm</span>
                            <span id="motorStateX" class="motor-state state-disabled">MOTOR_DISABLED</span>
                        </div>
                    </div>
                    <div class="position-display">
                        <span>Y Position:</span>
                        <div style="display: flex; align-items: center;">
                            <span id="posY">0.0 mm</span>
                            <span id="motorStateY" class="motor-state state-disabled">MOTOR_DISABLED</span>
                        </div>
                    </div>
                </div>
                
                <!-- Home Controls -->
                <div class="mb-4">
                    <h3 class="section-title">
                        <span>üè†</span>
                        Homing
                    </h3>
                    <div class="button-grid">
                        <button class="button btn-primary" onclick="homeAxis('')">Home All</button>
                        <button class="button btn-secondary" onclick="homeAxis('X')">Home X</button>
                        <button class="button btn-secondary" onclick="homeAxis('Y')">Home Y</button>
                        <button class="button btn-danger" onclick="disableMotor('X')">Disable X</button>
                        <button class="button btn-danger" onclick="disableMotor('Y')">Disable Y</button>
                    </div>
                </div>

                <!-- Move to Position -->
                <div>
                    <h3 class="section-title">Move to Position</h3>
                    <div class="mb-3">
                        <label class="text-sm">X Position (mm)</label>
                        <input type="number" id="xPositionInput" class="input" value="0" step="0.1">
                        <button class="button btn-success mb-2" onclick="moveToPosition('X')">Move X</button>
                    </div>
                    <div class="mb-3">
                        <label class="text-sm">Y Position (mm)</label>
                        <input type="number" id="yPositionInput" class="input" value="0" step="0.1">
                        <button class="button btn-success" onclick="moveToPosition('Y')">Move Y</button>
                    </div>
                </div>
            </div>

            <!-- Pneumatics Control -->
            <div class="card">
                <h2 class="card-title">
                    <span>üí®</span>
                    Pneumatic Controls
                </h2>
                
                <!-- Nozzle -->
                <div class="pneumatic-control">
                    <div class="pneumatic-status">
                        <div id="nozzleStatus" class="status-indicator"></div>
                        <span>Nozzle</span>
                    </div>
                    <div class="flex">
                        <button class="button btn-success" onclick="controlPneumatic('nozzle', 'extend')">Extend</button>
                        <button class="button btn-danger" onclick="controlPneumatic('nozzle', 'retract')">Retract</button>
                    </div>
                </div>

                <!-- Chip Stage -->
                <div class="pneumatic-control">
                    <div class="pneumatic-status">
                        <div id="stageStatus" class="status-indicator"></div>
                        <span>Chip Stage</span>
                    </div>
                    <div class="flex">
                        <button class="button btn-success" onclick="controlPneumatic('stage', 'extend')">Extend</button>
                        <button class="button btn-danger" onclick="controlPneumatic('stage', 'retract')">Retract</button>
                    </div>
                </div>

                <!-- Stamp -->
                <div class="pneumatic-control">
                    <div class="pneumatic-status">
                        <div id="stampStatus" class="status-indicator"></div>
                        <span>Stamp</span>
                    </div>
                    <div class="flex">
                        <button class="button btn-success" onclick="controlPneumatic('stamp', 'extend')">Extend</button>
                        <button class="button btn-danger" onclick="controlPneumatic('stamp', 'retract')">Retract</button>
                    </div>
                </div>

                <!-- Tape Motor -->
                <div class="mb-4">
                    <h3 class="section-title">
                        <span>üéûÔ∏è</span>
                        Tape Motor
                    </h3>
                    <div class="flex mb-2">
                        <input type="number" id="tapeSpeed" class="input" placeholder="Speed" value="100">
                        <label class="text-sm" style="white-space: nowrap; margin-right: 8px;">Speed</label>
                        <input type="number" id="tapeTorque" class="input" placeholder="Torque" value="50">
                        <label class="text-sm" style="white-space: nowrap;">Torque</label>
                    </div>
                    <div class="flex">
                        <input type="number" id="tapeTime" class="input" placeholder="Time (ms)" value="1000">
                        <label class="text-sm" style="white-space: nowrap; margin-right: 8px;">Time (ms)</label>
                        <button class="button btn-warning" onclick="runTapeMotor()">Run Tape</button>
                    </div>
                </div>

                <!-- Vacuum Controls -->
                <div>
                    <h3 class="section-title">
                        <span>üå™Ô∏è</span>
                        Vacuum Controls
                    </h3>
                    
                    <!-- Vacuum Nozzle -->
                    <div class="pneumatic-control">
                        <div class="pneumatic-status">
                            <div id="vacnozzleStatus" class="status-indicator"></div>
                            <span>Nozzle</span>
                        </div>
                        <div class="flex">
                            <button class="button btn-success" onclick="controlVacuum('vacnozzle', 'on')">On</button>
                            <button class="button btn-danger" onclick="controlVacuum('vacnozzle', 'off')">Off</button>
                        </div>
                    </div>

                    <!-- Chuck Vacuum -->
                    <div class="pneumatic-control">
                        <div class="pneumatic-status">
                            <div id="chuckStatus" class="status-indicator"></div>
                            <span>Chuck</span>
                        </div>
                        <div class="flex">
                            <button class="button btn-success" onclick="controlVacuum('chuck', 'on')">On</button>
                            <button class="button btn-danger" onclick="controlVacuum('chuck', 'off')">Off</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Temperature Control -->
            <div class="card">
                <h2 class="card-title">
                    <span>üå°Ô∏è</span>
                    Chip Temperature Control
                </h2>
                
                <div class="temp-display mb-3">
                    <span>Current Temperature:</span>
                    <span id="currentTemp" class="temp-current">0¬∞C</span>
                </div>
                
                <div class="temp-display mb-3">
                    <span>Target Temperature:</span>
                    <span id="targetTemp" class="temp-current" style="color: #F59E0B;">0¬∞C</span>
                </div>
                
                <div class="flex mb-3">
                    <input type="number" id="tempInput" class="input" value="25" min="0" max="200">
                    <button class="button btn-danger" onclick="setTemperature()">Set Temp</button>
                </div>

                <!-- Temperature Chart -->
                <div class="chart-container">
                    <canvas id="tempChart"></canvas>
                </div>
            </div>

            <!-- Console -->
            <div class="card">
                <h2 class="card-title">
                    <span>üíª</span>
                    Console
                </h2>
                <div id="console" class="console">
                    <div class="console-line">Machine control interface ready...</div>
                </div>
                
                <div class="flex mt-3">
                    <input type="text" id="customCommand" class="input" placeholder="Enter custom command...">
                    <button class="button btn-primary" onclick="sendCustomCommand()">Send</button>
                </div>
            </div>



            <div class="card selector">
                <h2 class="card-title">
                    <span>‚öôÔ∏è</span>
                    Selector
                </h2>

                <div class="chips">
                    <!-- Row A -->
                    <div class="row">
                        <button id="A1" class="chip A 1"></button>
                        <button id="A2" class="chip A 2"></button>
                        <button id="A3" class="chip A 3"></button>
                        <button id="A4" class="chip A 4"></button>
                        <button id="A5" class="chip A 5"></button>
                        <button id="A6" class="chip A 6"></button>
                        <button id="A7" class="chip A 7"></button>
                        <button id="A8" class="chip A 8"></button>
                        <button id="A9" class="chip A 9"></button>
                        <button id="A10" class="chip A 10"></button>
                    </div>
                    <!-- Row B -->
                    <div class="row">
                        <button id="B1" class="chip B 1"></button>
                        <button id="B2" class="chip B 2"></button>
                        <button id="B3" class="chip B 3"></button>
                        <button id="B4" class="chip B 4"></button>
                        <button id="B5" class="chip B 5"></button>
                        <button id="B6" class="chip B 6"></button>
                        <button id="B7" class="chip B 7"></button>
                        <button id="B8" class="chip B 8"></button>
                        <button id="B9" class="chip B 9"></button>
                        <button id="B10" class="chip B 10"></button>
                    </div>
                    <!-- Row C -->
                    <div class="row">
                        <button id="C1" class="chip C 1"></button>
                        <button id="C2" class="chip C 2"></button>
                        <button id="C3" class="chip C 3"></button>
                        <button id="C4" class="chip C 4"></button>
                        <button id="C5" class="chip C 5"></button>
                        <button id="C6" class="chip C 6"></button>
                        <button id="C7" class="chip C 7"></button>
                        <button id="C8" class="chip C 8"></button>
                        <button id="C9" class="chip C 9"></button>
                        <button id="C10" class="chip C 10"></button>
                    </div>
                    <!-- Row D -->
                    <div class="row">
                        <button id="D1" class="chip D 1"></button>
                        <button id="D2" class="chip D 2"></button>
                        <button id="D3" class="chip D 3"></button>
                        <button id="D4" class="chip D 4"></button>
                        <button id="D5" class="chip D 5"></button>
                        <button id="D6" class="chip D 6"></button>
                        <button id="D7" class="chip D 7"></button>
                        <button id="D8" class="chip D 8"></button>
                        <button id="D9" class="chip D 9"></button>
                        <button id="D10" class="chip D 10"></button>
                    </div>
                    <!-- Row E -->
                    <div class="row">
                        <button id="E1" class="chip E 1"></button>
                        <button id="E2" class="chip E 2"></button>
                        <button id="E3" class="chip E 3"></button>
                        <button id="E4" class="chip E 4"></button>
                        <button id="E5" class="chip E 5"></button>
                        <button id="E6" class="chip E 6"></button>
                        <button id="E7" class="chip E 7"></button>
                        <button id="E8" class="chip E 8"></button>
                        <button id="E9" class="chip E 9"></button>
                        <button id="E10" class="chip E 10"></button>
                    </div>
                    <!-- Row F -->
                    <div class="row">
                        <button id="F1" class="chip F 1"></button>
                        <button id="F2" class="chip F 2"></button>
                        <button id="F3" class="chip F 3"></button>
                        <button id="F4" class="chip F 4"></button>
                        <button id="F5" class="chip F 5"></button>
                        <button id="F6" class="chip F 6"></button>
                        <button id="F7" class="chip F 7"></button>
                        <button id="F8" class="chip F 8"></button>
                        <button id="F9" class="chip F 9"></button>
                        <button id="F10" class="chip F 10"></button>
                    </div>

                    <button id="submitChipQuery" onclick="submitChips()">Select chips</button>
                </div>
            </div>
        </div>
    </div>

</body>
</html>